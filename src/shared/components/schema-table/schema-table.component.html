<div class="table_actions">
  <button nz-button nzType="primary" *ngFor="let x of tableActions" (click)="x.open(nzTable.data);"><i class="anticon {{x.icon}}"></i>{{x.name}}...</button>
  <button nz-button nzType="primary" (click)="asp.reset(); updateItem={};visibleDrawer=true;"><i class="anticon anticon-addfile"></i>新建...</button>
  <button nz-button nz-popover nzType="primary" nzTitle="查询" [(nzVisible)]="visible" nzTrigger="click" [nzContent]="filterTemplate"
    nzPlacement="bottomRight"><i class="anticon anticon-filter"></i>查询...</button>
</div>
<ng-template #filterTemplate>
  <div *ngFor="let col of cloumns" class="filter-item">
    <ng-container *ngIf="col.type=='number'">
      <nz-input-group nzCompact style="min-width:100px;">
        <input type="text" nz-input placeholder=" {{col.title}} Min" style="width:45%; text-align: center;" (blur)="filter(col,'ge',$event.target.value)">
        <input type="text" disabled nz-input placeholder="~" style="width:10%; border-left: 0px; pointer-events: none; background-color: rgb(255, 255, 255); padding:4px 0; text-align: center">
        <input type="text" nz-input placeholder="{{col.title}} Max" style="width:45%; text-align: center; border-left: 0px;"
          (blur)="filter(col,'le',$event.target.value)">
      </nz-input-group>
    </ng-container>
    <ng-container *ngIf="col.type=='enum'">
      <nz-select style='width: 100%' [(ngModel)]="_enumValue" nzAllowClear nzPlaceHolder="Choose" (ngModelChange)="filter(col,'eq',$event)">
        <nz-option *ngFor="let op of col.enum" [nzValue]="op" [nzLabel]="op"></nz-option>
      </nz-select>
    </ng-container>
    <ng-container *ngIf="col.type=='boolean'">
      <nz-select style='width: 100%' nzAllowClear nzPlaceHolder="Choose" [(ngModel)]="_booleanValue" (ngModelChange)="filter(col,'eq',$event)">
        <nz-option *ngFor="let op of [{v:true,name:'是'},{v:false,name:'否'}]" [nzValue]="op.v" [nzLabel]="op.name"></nz-option>
      </nz-select>
    </ng-container>
    <ng-container *ngIf="col.type=='datetime'">
      <nz-range-picker [nzPlaceHolder]="[ col.title+' Start', col.title+' End' ]" (ngModelChange)="filter(col,'ge',$event)"
        ngModel [nzFormat]="dateFormat" style='width: 100%'></nz-range-picker>
    </ng-container>
    <ng-container *ngIf="col.type=='string'">
      <nz-input-group nzSuffixIcon="anticon anticon-search" nzAllowClear>
        <input nz-input id=" name" (blur)="filter(col,'contains',$event.target.value)" autocomplete="off" placeholder="{{col.title}}">
      </nz-input-group>
    </ng-container>
  </div>
  <div>
    <button nz-button nzType="primary" style="width:100%" (click)="clearFilter();">取消搜索</button>
  </div>
</ng-template>
<nz-table #nzTable [nzData]="dataSet" [nzTotal]="total" [nzPageIndex]="pageindex" [nzPageSize]="pagesize" nzSize="middle"
  [nzShowSizeChanger]="true" [nzFrontPagination]='false' (nzPageIndexChange)="getpage($event,pagesize)"
  (nzPageSizeChange)="getpage(pageindex,$event)" [nzLoading]="loading">
  <thead>
    <tr class="thead">
      <th nzWidth="30px" nzLeft="0px" nzShowCheckbox [(nzChecked)]="allChecked" [nzIndeterminate]="indeterminate"
        (nzCheckedChange)="checkAll($event)"></th>
      <th *ngFor="let col of cloumns" nzWidth="100px" nzShowSort [(nzSort)]="sortMap[col.name]" (nzSortChange)="sort(col.name,$event)">{{col.title}}</th>
      <th nzWidth="40px" class="text-right actions">
        <i class="anticon anticon-bars"></i>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let data of nzTable.data;let i=index; " class="data-row">
      <td nzLeft="0px" nzShowCheckbox [(nzChecked)]="data.checked" [nzDisabled]="data.disabled" (nzCheckedChange)="refreshStatus($event)"></td>
      <td *ngFor="let col of cloumns">
        <ng-container *ngIf="col.type=='upload'">
          <a [href]="transformUrl(data[col.name])" *ngIf="data[col.name]" nz-button nzShape="circle"><i class="anticon anticon-download"></i></a>
        </ng-container>
        <ng-container *ngIf="col.type=='boolean'">
          <nz-switch [(ngModel)]="data[col.name]" [nzDisabled]="true"></nz-switch>
        </ng-container>
        <ng-container *ngIf="col.type=='string' || col.type=='number' || col.type=='enum'">
          {{data[col.name]}}
        </ng-container>
        <ng-container *ngIf="col.type=='datetime'">
          {{data[col.name]|date:'yyyy-MM-dd HH:mm'}}
        </ng-container>
      </td>
      <td nzWidth="80px" nzRight="0px" class="text-right actions">
        <nz-dropdown [nzPlacement]="'bottomRight'">
          <a nz-dropdown>
            <strong><i class="anticon anticon-ellipsis"></i></strong>
          </a>
          <ul nz-menu>
            <li nz-menu-item>
              <a><i class="anticon anticon-delete"></i>删除</a>
            </li>
            <li nz-menu-item>
              <a (click)=" updateItem=data; visibleDrawer=true;"><i class="anticon anticon-edit"></i>编辑...</a>
            </li>
            <li nz-menu-divider></li>
            <li nz-menu-item *ngFor="let x of rowActions">
              <a (click)="x.open(data);"><i class="anticon {{x.icon}}"></i>{{x.name}}...</a>
            </li>
          </ul>
        </nz-dropdown>
      </td>
    </tr>
  </tbody>
</nz-table>

<nz-drawer [nzMaskClosable]="false" [nzWidth]="720" [nzVisible]="visibleDrawer" nzTitle="Create" (nzOnClose)="visibleDrawer=false;">
  <app-schema-form [formData]='updateItem' [schema]="schema" (formSumbit)="save($event)" #asp>
    <div class="footer">
      <button nz-button type="button" (click)="visibleDrawer=false;">取 消</button>
      <button nz-button type="submit" [nzType]="'primary'" [nzLoading]="httpLoading.value">确 定</button>
    </div>
  </app-schema-form>

</nz-drawer>
